打包
====

python
------

### selenium打包

项目的结构如下

```lua
/your_project_directory
    |-- purchase.py
    |-- chromedriver.exe
    |-- chrome
        |-- App
        |   |-- Chrome-bin
        |       |-- chrome.exe
        |-- ...
```



1. 添加这里到python文件的头部，可以同步把python文件的print输出以日志形式打印到`output.log`这个文件

```python
import logging
import sys


# 创建一个自定义过滤器，只允许来自PrintLogger的消息通过
class PrintLoggerFilter(logging.Filter):
    def filter(self, record):
        return record.name == "PrintLogger"


# 创建一个logger
logger = logging.getLogger("PrintLogger")
logger.setLevel(logging.INFO)  # 只记录INFO及以上级别的消息

# 创建一个文件处理器，将日志输出到文件
file_handler = logging.FileHandler("output.log")
file_handler.setLevel(logging.INFO)

# 创建一个流处理器，将日志输出到命令行
stream_handler = logging.StreamHandler(sys.stdout)
stream_handler.setLevel(logging.INFO)

# 设置日志格式
formatter = logging.Formatter("%(asctime)s - %(message)s")
file_handler.setFormatter(formatter)
stream_handler.setFormatter(formatter)

# 添加过滤器到处理器
file_handler.addFilter(PrintLoggerFilter())
stream_handler.addFilter(PrintLoggerFilter())

# 添加处理器到logger
logger.addHandler(file_handler)
logger.addHandler(stream_handler)


# 重定向print到logger
class PrintLogger:
    def write(self, message):
        if message.strip() != "":
            logger.info(message.strip())

    def flush(self):
        pass


sys.stdout = PrintLogger()
sys.stderr = PrintLogger()
```

2. 添加下面的内容，可以把浏览器以及driver打包到exe的时候不会出现路径的问题，因为exe会解压缓存的的文件，会和本地的路径存在差异

```python
def resource_path(relative_path):
    """获取资源的绝对路径"""
    try:
        # PyInstaller创建临时文件夹，并存储路径到 _MEIPASS
        base_path = sys._MEIPASS
    except Exception:
        base_path = os.path.abspath(".")

    return os.path.join(base_path, relative_path)


def start_browser():
    # 获取驱动程序的路径
    driver_path = resource_path("chromedriver.exe")
    # 获取Chrome Portable的路径
    chrome_path = resource_path(
        os.path.join("chrome", "App", "Chrome-bin", "chrome.exe")
    )
    options = uc.ChromeOptions()
    options.add_argument(r"--start-maximized")
    options.binary_location = chrome_path
    driver = uc.Chrome(executable_path=driver_path, options=options)
    driver.get("https://d2.delima.edu.my/login")
    return driver
```

3. 使用下面的命令，即可打包成应用程序

```bash
pyinstaller --onefile --add-data "chromedriver.exe;." --add-data "chrome;chrome" purchase.py
```

